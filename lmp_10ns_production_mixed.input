# define baseName via command line swicth "-v baseName systemXYZ"
# also define restartFile to override default name below

# setting $is_restart continues a run from given restart file
# Source: https://lammps.sandia.gov/doc/read_restart.html
# Here is a list of information not stored in a restart file, which means you
# must re-issue these commands in your input script, after reading the restart
# file.
#    newton pair (see discussion of newton command below)
#    fix commands (see below)
#    compute commands (see below)
#    variable commands
#    region commands
#    neighbor list criteria including neigh_modify settings
#    kspace_style and kspace_modify settings
#    info for thermodynamic, dump, or restart output
# expects variables ${baseName} and ${restartFile}

# technical settings
variable mpiio          index  1         # parallel io on or off
variable is_restart     index  0         # marks current run as restart

# for the initial run, a small file called system_specific.input is expected
# to define the variable $baseName
if   "${is_restart} == 0" then "print 'Initial run on system ${baseName}'" &
elif "${mpiio}      == 0"      "variable restartFile index default.restart" &
else                           "variable restartFile index default.mpiio.restart"
# in the last case, run is restart and mpiio is used

if "${is_restart} == 0" then "variable dataFile string ${baseName}_nptEquilibrated.lammps"

log                     ${baseName}_10ns_production_mixed.log

variable mixedProductionSteps   equal   5000000    # 10 ns

print "Variables in lmp_10ns_production_mixed.input:"
info variables

if "${is_restart} > 0" then "read_restart ${restartFile}"
include                 lmp_header.input

# consecutively numbered restart files ...
# restart               100000 ${baseName}.restart # every 200 ps
# ... or two alternating files ...
if "${mpiio} > 0" then &
  "print 'mpiio restart files'" &
  "restart  100000 ${baseName}.mpiio.restart1 ${baseName}.mpiio.restart2" &
else &
  "print 'standard restart files (no mpiiio)'" &
  "restart 100000 ${baseName}.restart1 ${baseName}.restart2"
# Source: https://lammps.sandia.gov/doc/restart.html
# [...]
# If a “%” character appears in the restart filename(s), then one file is
# written for each processor and the “%” character is replaced with the
# processor ID from 0 to P-1. An additional file with the “%” replaced by
# “base” is also written, which contains global information. For example,
# the files written on step 1000 for filename restart.% would be
# restart.base.1000, restart.0.1000, restart.1.1000, …, restart.P-1.1000.
# This creates smaller files and can be a fast mode of output and subsequent
# input on parallel machines that support parallel I/O. The optional fileper
# and nfile keywords discussed below can alter the number of files written.
#
# The restart file can also be written in parallel as one large binary file via
# the MPI-IO library, which is part of the MPI standard for versions 2.0 and
# above. Using MPI-IO requires two steps. First, build LAMMPS with its MPIIO
# package installed [...]
#
# Second, use a restart filename which contains “.mpiio”. Note that it does not
# have to end in “.mpiio”, just contain those characters. Unlike MPI-IO dump
# files, a particular restart file must be both written and read using MPI-IO.
#                       ^ every 200 ps

include                 lmp_production_mixed.input
