variable                robust_minimization index 0

include                 system_specific.input
variable dataFile       string  ${baseName}_psfgen.data

log                     ${baseName}_minimization.log

include                 lmp_header.input

thermo                  100
##############
# minimization
##############
# fix restraint surfactant spring/self 10.0
# http://lammps.sandia.gov/doc/fix_spring_self.html
# Apply a spring force independently to each atom in the group to tether it to
# its initial position. The initial position for each atom is its location at
# the time the fix command was issued. At each timestep, the magnitude of the
# force on each atom is -Kr, where r is the displacement of the atom from its
# current position to its initial position. The distance r correctly takes into
# account any crossings of periodic boundary by the atom since it was in its
# initial position.

if "${robust_minimization} > 0" then &
  "print 'Using alternative robust minimization settings'" &
  "neigh_modify delay 0 every 1 check yes one 5000 page 250000" &
  "minimize 0.0 1.0 10000 100000" &
else &
  "minimize 0.0 1.0 10000 100000"

# minimize etol ftol maxiter maxeval
# Quote from http://lammps.sandia.gov/doc/minimize.html
# Perform an energy minimization of the system, by iteratively adjusting atom
# coordinates. Iterations are terminated when one of the stopping criteria is
# satisfied. At that point the configuration will hopefully be in local
# potential energy minimum. More precisely, the configuration should
# approximate a critical point for the objective function (see below), which
# may or may not be a local minimum.
#
#    etol = stopping tolerance for energy (unitless)
#    ftol = stopping tolerance for force (force units)
#    maxiter = max iterations of minimizer
#    maxeval = max number of force/energy evaluations
#
# Either or both of the etol and ftol values can be set to 0.0, in which case
# some other criterion will terminate the minimization.

write_data     ${baseName}_minimized.lammps

reset_timestep  0
