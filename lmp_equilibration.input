variable dataFile       string  "1_SDS_on_AU_100_1x4x4_psfgen.data"
variable baseName       string  "1_SDS_on_AU_100_1x4x4"

log                     ${baseName}_00.log

include                 lmp_header.input

##############
# minimization
##############
# fix restraint surfactant spring/self 10.0
# http://lammps.sandia.gov/doc/fix_spring_self.html
# Apply a spring force independently to each atom in the group to tether it to 
# its initial position. The initial position for each atom is its location at 
# the time the fix command was issued. At each timestep, the magnitude of the 
# force on each atom is -Kr, where r is the displacement of the atom from its 
# current position to its initial position. The distance r correctly takes into
# account any crossings of periodic boundary by the atom since it was in its 
# initial position.


log ${baseName}_01_minimization.log
minimize 0.0 10.0 1000 2000
log ${baseName}_00.log append
# Quote from http://lammps.sandia.gov/doc/minimize.html
# Perform an energy minimization of the system, by iteratively adjusting atom
# coordinates. Iterations are terminated when one of the stopping criteria is
# satisfied. At that point the configuration will hopefully be in local
# potential energy minimum. More precisely, the configuration should
# approximate a critical point for the objective function (see below), which
# may or may not be a local minimum.
#
#    etol = stopping tolerance for energy (unitless)
#    ftol = stopping tolerance for force (force units)
#    maxiter = max iterations of minimizer
#    maxeval = max number of force/energy evaluations
#
# Either or both of the etol and ftol values can be set to 0.0, in which case
# some other criterion will terminate the minimization.

write_data     ${baseName}_minimized.lammps

reset_timestep  0

###################
# NVT equilibration
###################
fix equilibrateNVT all nvt temp ${temperatureT} ${temperatureT} 100 tchain 1
#  WARNING: Fix rattle should come after all other integration fixes
#    (../fix_rattle.cpp:147)
fix rigidHbonds all rattle 1e-6 500 0 m 1.0 a ${angleIdWater}
# The b constraint lists bond types that will be constrained.
# The t constraint lists atom types. All bonds connected to an
#  atom of the specified type will be constrained. The m constraint
# lists atom masses. All bonds connected to atoms of the specified
# masses will be constrained (within a fudge factor of MASSDELTA specified
# in fix_shake.cpp). The a constraint lists angle types. If both bonds in
# the angle are constrained then the angle will also be constrained if its
# type is in the list.
# The mentioned MASSDELTA is defined as 0.1 (16Mar18).
# Therefore, all hydrogen
# The fix rattle command modifies forces and velocities and thus should be
# defined after all other integration fixes in your input script. If you
# define other fixes that modify velocities or forces after fix rattle operates,
# then fix rattle will not take them into account and the overall time
# integration will typically not satisfy the RATTLE constraints. You can
# check whether the constraints work correctly by setting the value of
# RATTLE_DEBUG in src/fix_rattle.cpp to 1 and recompiling LAMMPS.
# The degrees-of-freedom removed by SHAKE bonds and angles are accounted for in
# temperature and pressure computations. Similarly, the SHAKE contribution to
# the pressure of the system (virial) is also accounted for.

velocity        all create ${temperatureT} 29061988 rot yes mom yes dist gaussian
# Quote from http://lammps.sandia.gov/doc/velocity.html
# The mom and rot keywords are used by create. If mom = yes, the linear momentum
# of the newly created ensemble of velocities is zeroed; if rot = yes, the
# angular momentum is zeroed.

dump            dumpTraj all atom 100 ${baseName}_nvtEquilibration.dump
log             ${baseName}_02_nvtEquilibration.log

run             ${nvtEqSteps}

log             ${baseName}_00.log append
write_data      ${baseName}_nvtEquilibrated.lammps

undump          dumpTraj
unfix           equilibrateNVT
unfix           rigidHbonds

###################
# NPT equilibration
###################
fix             rigidHbonds all shake 1e-6 500 0 m 1.0 a ${angleIdWater}
fix             equilibrateNPT all npt temp ${temperatureT} ${temperatureT} &
                  100 iso ${pressureP} ${pressureP} 100 tchain 1 pchain 1
#                                           ^                     Tstart / K
#                                                           ^     Tstop
#                 ^                                               Tdamp/steps
#                         ^                                       Pstart/atm
#                                      ^                          Pstop
#                                                   ^             Pdamp/steps
dump            dumpTraj all atom 100 ${baseName}_nptEquilibration.dump
log             ${baseName}_03_nptEquilibration.log

run             ${nptEqSteps}

log             ${baseName}_00.log append
write_data      ${baseName}_nptEquilibrated.lammps
