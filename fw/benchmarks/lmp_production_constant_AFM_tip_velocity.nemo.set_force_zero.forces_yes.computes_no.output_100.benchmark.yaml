name: "LAMMPS Production Run on NEMO Benchmark"
fws:
- fw_id: -1
  name: "NEMO LAMMPS benchmark, 8 nodes, 20 ppn, 1000 steps, output every 100 steps, no group/group computes,rigid indenter by setforce zero"
  spec:
    _category: "nemo_queue"
    _queueadapter:
      nodes: 8
      ppn: 20
      queue: 'express'
      walltime: 00:15:00
    _files_out:
      data_file:       default.lammps
      traj_file:       default.nc
      log_file:        log.lammps
      ave_file:        thermo_ave.out
    _tasks:
    - _fw_name: GetFilesTask
      identifiers:
      - lmp_header.input
      - lmp_production.input
      - lmp_production_mixed.input
      - 646_SDS_on_AU_111_51x30x2_hemicylinders_with_counterion_50Ang_stepped_nptEquilibrated.lammps
      new_file_names:
      - lmp_header.input
      - lmp_production.input
      - lmp_production_mixed.input
      - datafile.lammps
    - _fw_name: CmdTask
      cmd: lmp
      opt:
      - -in lmp_production.input
      - -v surfactant_name SDS
      - -v has_indenter 1
      - -v constant_indenter_velocity -0.0001
      - -v productionSteps 1000
      - -v pbc2d 0
      - -v reinitialize_velocities 0
      - -v use_colvars 0
      - -v mpiio 1
      - -v thermo_frequency 100
      - -v thermo_average_frequency 100
      - -v netcdf_frequency 100
      - -v restart_frequency 10000
      - -v compute_interactions 0
      - -v store_forces 1
      - -v nve_noforce 0
      stderr_file:   std.err
      stdout_file:   std.out
      fizzle_bad_rc: true
      use_shell:     true

- fw_id: -2
  name: "NEMO extract forces from NetCDF"
  spec:
    _category: "nemo_noqueue"
    _allow_fizzled_parents: True
    _files_in:
      traj_file:       default.nc # from previous post-processing task
      thermo_file:     thermo.out
      ave_file:        thermo_ave.out

    _files_out:
      indenter_forces:       indenter_z_forces.txt
      nonindenter_forces:    nonindenter_z_forces.txt

    _tasks:
    - _fw_name: CmdTask
      cmd: extract_indenter_nonindenter_forces_from_netcdf.py
      opt:
      - --element Au
      - --dim 2
      - --plane 20.0
      - --netcdf-output-interval 1000
      - --output-formats txt
      - --verbose
      - default.nc # input file
      - indenter_z_forces # output file name without extension
      - nonindenter_z_forces
      stderr_file:   std.err
      stdout_file:   std.out
      fizzle_bad_rc: true
      use_shell:     true

links: 
  -1:
  - -2

metadata:
  type: benchmark
  settings: 
  - rigid indenter by setforce 0
  - output every 100 steps
  - no compute group/group
  - forces stored in netcdf