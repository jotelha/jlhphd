name: "LAMMPS Production run on NEMO"
fws:
- fw_id: -1
  name: "NEMO LAMMPS Production, online"
  spec:
    _category: "nemo_queue"
    _queueadapter:
      nodes: 8
      ppn: 20
      queue: ''
      walltime: 96:00:00
    _files_in:
      data_file:       datafile.lammps
    _files_out:
      data_file:       default.lammps
      traj_file:       default.nc
      log_file:        log.lammps
      ave_file:        thermo_ave.out
    _tasks:
    - _fw_name: GetFilesTask
      identifiers:
      - lmp_header.input
      - lmp_production.input
      - lmp_production_mixed.input
    - _fw_name: CmdTask
      cmd: lmp
      opt:
      - -in lmp_production.input
      - -v surfactant_name SDS
      - -v has_indenter 1
      - -v constant_indenter_velocity -0.000001
      - -v productionSteps 37500000
      - -v pbc2d 0
      - -v reinitialize_velocities 0
      - -v use_colvars 0
      - -v mpiio 1
      - -v thermo_frequency 10000
      - -v thermo_average_frequency 10000
      - -v netcdf_frequency 100000
      - -v compute_interactions 1
      - -v store_forces 1
      stderr_file:   std.err
      stdout_file:   std.out
      fizzle_bad_rc: true
      use_shell:     true
    _trackers:
    - filename: log.lammps
      nlines: 25

- fw_id: -2
  name: "NEMO LAMMPS Post-Production"
  spec:
    _category: "nemo_noqueue"
    _files_in:
      log_file:  log.lammps
      data_file: datafile.lammps
      ave_file:  thermo_ave.out
    _files_out:
      thermo_file: thermo.out
    _tasks:

    - _fw_name: GetFilesTask
      identifiers:
      - extract_thermo.sh

    - _fw_name: ScriptTask
      script:
      - bash extract_thermo.sh log.lammps thermo.out
      use_shell:     true
      fizzle_bad_rc: false

    # first delete if file existent
    - _fw_name: DeleteFilesTask
      identifiers:
      - 646_SDS_on_AU_111_51x30x2_monolayer_with_counterion_50Ang_stepped_37500000_steps.lammps
      - 646_SDS_on_AU_111_51x30x2_monolayer_with_counterion_50Ang_stepped_37500000_steps_thermo.out
      - 646_SDS_on_AU_111_51x30x2_monolayer_with_counterion_50Ang_stepped_37500000_steps_thermo_ave.out
      - 646_SDS_on_AU_111_51x30x2_monolayer_with_counterion_50Ang_stepped_37500000_steps.log

    # then add again:
    - _fw_name: AddFilesTask
      identifiers:
      - 646_SDS_on_AU_111_51x30x2_monolayer_with_counterion_50Ang_stepped_37500000_steps.lammps
      - 646_SDS_on_AU_111_51x30x2_monolayer_with_counterion_50Ang_stepped_37500000_steps_thermo.out
      - 646_SDS_on_AU_111_51x30x2_monolayer_with_counterion_50Ang_stepped_37500000_steps_thermo_ave.out
      - 646_SDS_on_AU_111_51x30x2_monolayer_with_counterion_50Ang_stepped_37500000_steps.log
      paths:
      - datafile.lammps
      - thermo.out
      - thermo_ave.out
      - log.lammps
      metadata:
      - system_name:      646_SDS_on_AU_111_51x30x2_monolayer_with_counterion_50Ang_stepped
        surfactant:       SDS
        sf_nmolecules:    646
        sf_preassembly:   monolayer
        counterion:       NA
        ci_preassembly:   at polar heads
        substrate:        AU
        sb_name:          AU_111_51x30x2
        sb_crystal_plane: 111
        sb_multiples:
        - 51
        - 30
        - 2
        solvent:          H2O
        sv_density:       997 # kg m^-3
        sv_preassembly:   random
        indenter:         AU
        indenter_pdb:     50Ang_stepped
        indenter_vel:     0.1 # m / s, constant speed, linear translation
        indenter_dist:    7.5 # nm, initial distance above substrate
        temperature:      298 # K
        pressure:         1 # atm
        total_steps:      37500000 # a 2 fs each
        total_time:       75 # ns
        state:            probed

links:
  -1:
  - -2

metadata:
  - system_name:      646_SDS_on_AU_111_51x30x2_monolayer_with_counterion_50Ang_stepped
    surfactant:       SDS
    sf_nmolecules:    646
    sf_preassembly:   monolayer
    counterion:       NA
    ci_preassembly:   at polar heads
    substrate:        AU
    sb_name:          AU_111_51x30x2
    sb_crystal_plane: 111
    sb_multiples:
    - 51
    - 30
    - 2
    solvent:          H2O
    sv_density:       997 # kg m^-3
    sv_preassembly:   random
    indenter:         AU
    indenter_pdb:     50Ang_stepped
    indenter_vel:     0.1 # m / s, constant speed, linear translation
    indenter_dist:    7.5 # nm, initial distance above substrate
    temperature:      298 # K
    pressure:         1 # atm
    total_steps:      37500000 # a 2 fs each
    total_time:       75 # ns
