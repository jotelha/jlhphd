{% extends "fw_base_production.yaml" %}
{% block body %}
name: {{machine}}, sync '{{identifier}}' results to RZ storage
spec:
  _category: "{{ worker|default("nemo_noqueue",true) }}"
  _files_in:
    data_file:          default.lammps
    filtered_traj_file: filtered.nc
    indenter_forces:    indenter_forces.txt
    log_file:           log.lammps
    ndx_file:           groups.ndx
    joint_traj_file:    default.nc
    joint_thermo_file:  thermo.out
    joint_ave_file:     thermo_ave.out
  {{ render_smb_forward()|indent(2) }}
  _tasks:
  {% autoescape false %}{{ render_wait_for_port()|indent(2) }}{% endautoescape %}
  - _fw_name: CmdTask
    cmd: smbsync.py
    opt:
    - --server_name {{ smb_port_provider|default("localhost",true) }}
    - --share       {{ smb_share|default("pastewka",true) }}
    - --domain      {{ smb_domain|default("PUBLIC",true) }}
    - --username    {{ smb_user|default("pastewka",true) }}
    - --server_port {{ smb_port_local|default("445",true) }}
    - --verbose
    - .
    - hoermannj/2019/md/{{ identifier }}
    stderr_file:   std.err
    stdout_file:   std.out
    store_stdout:  true
    store_stderr:  true
    fizzle_bad_rc: true
    use_shell:     true
  metadata:
    state: file transfer to RZ storage
    {{ render_metadata()|indent(4) }}
{% endblock %}
