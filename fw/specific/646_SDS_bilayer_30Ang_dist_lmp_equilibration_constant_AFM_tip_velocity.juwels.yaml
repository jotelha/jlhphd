name: "JUWELS LAMMPS Minimzation and Equilibrations: 646 SDS bilayer, indenter stepped, 30 Ang initial distance"
fws:
- fw_id: -10
  name: "File Retrieval"
  spec:
    _category: "juwels_noqueue"
    _files_out:
      data_file:       datafile.lammps
      input_file_1:    lmp_header.input
      input_file_2:    lmp_minimization.input
    _tasks:
    - _fw_name: GetFilesTask
      identifiers:
      - lmp_header.input
      - lmp_minimization.input
      - 646_SDS_on_AU_111_51x30x2_bilayer_with_counterion_50Ang_stepped_30Ang_dist_initial.lammps
      new_file_names:
      - lmp_header.input
      - lmp_minimization.input
      - datafile.lammps

- fw_id: -20
  name: LAMMPS Minimization
  spec:
    _category: juwels_queue
    _files_in:
      data_file:    datafile.lammps
      input_file_1: lmp_header.input
      input_file_2: lmp_minimization.input
    _files_out:
      data_file: default.lammps
      log_file:  log.lammps
    _queueadapter:
      nodes:           1
      ntasks:          96
      ntasks_per_node: 96
      queue:           batch
      walltime:        08:00:00
      account:         hfr13
    _tasks:
    - _fw_name: CmdTask
      fizzle_bad_rc: true
      cmd: lmp
      opt:
      - -in lmp_minimization.input
      - -v surfactant_name SDS
      - -v has_indenter 1
      - -v mpiio 0
      - -v robust_minimization 0
      - -v pbc2d 0
      - -v compute_interactions 0
      - -v store_forces 0
      - -v freeze_substrate 1
      stderr_file: std.err
      stdout_file: std.out
      use_shell: true
    _trackers:
    - filename: log.lammps
      nlines: 25
    step: minimization

- fw_id: -25
  name: "Pre-NPT File Retrieval"
  spec:
    _category: "juwels_noqueue"
    _files_out:
      input_file_1:    lmp_header.input
      input_file_2:    lmp_equilibration_nvt.input
    _tasks:
    - _fw_name: GetFilesTask
      identifiers:
      - lmp_header.input
      - lmp_equilibration_nvt.input

- fw_id: -30
  name: LAMMPS Equilibration NVT
  spec:
    _category: juwels_queue
    _files_in:
      data_file: datafile.lammps
    _files_out:
      data_file: default.lammps
      traj_file: default.nc
      log_file:  log.lammps
    _queueadapter:
      nodes:           2
      ntasks:          192
      ntasks_per_node: 96
      queue:           batch
      walltime:        24:00:00
      account:         hfr13
    _tasks:
    - _fw_name: CmdTask
      cmd: lmp
      opt:
      - -in lmp_equilibration_nvt.input
      - -v surfactant_name SDS
      - -v has_indenter 1
      - -v pbd2d 0
      - -v reinitialize_velocities 1
      - -v nvtEqSteps 10000
      - -v compute_interactions 0
      - -v store_forces 0
      - -v mpiio 1
      stderr_file: std.err
      stdout_file: std.out
      use_shell: true
      fizzle_bad_rc: true
    _trackers:
    - filename: log.lammps
      nlines: 25
    step: equilibration_nvt

- fw_id: -40
  name: "LAMMPS Post-NVT-Equilibration"
  spec:
    _category: "juwels_noqueue"
    _files_in:
      log_file:  log.lammps
    _files_out:
      thermo_file: thermo.out
    _tasks:
    _fw_name: CmdTask
      cmd: extract_thermo.sh # extracts thermo output from lammps log
      opt:
      - log.lammps # input file
      - thermo.out # output file
      stderr_file:   extract_thermo.err
      stdout_file:   extract_thermo.out
      fizzle_bad_rc: false
      use_shell:     true

- fw_id: -45
  name: "Pre-NPT File Retrieval"
  spec:
    _category: "juwels_noqueue"
    _files_out:
      input_file_1:    lmp_header.input
      input_file_2:    lmp_equilibration_npt.input
    _tasks:
    - _fw_name: GetFilesTask
      identifiers:
      - lmp_header.input
      - lmp_equilibration_npt.input

- fw_id: -50
  name: LAMMPS Equilibration NPT
  spec:
    _category: juwels_queue
    _files_in:
      data_file: datafile.lammps
      input_file_1:    lmp_header.input
      input_file_2:    lmp_equilibration_npt.input
    _files_out:
      data_file: default.lammps
      traj_file: default.nc
      log_file:  log.lammps
    _queueadapter:
      nodes:           2
      ntasks:          192
      ntasks_per_node: 96
      queue:           batch
      walltime:        24:00:00
      account:         hfr13
    _tasks:
    - _fw_name: CmdTask
      cmd: lmp
      opt:
      - -in lmp_equilibration_npt.input
      - -v surfactant_name SDS
      - -v has_indenter 1
      - -v pbd2d 0
      - -v reinitialize_velocities 0
      - -v nptEqSteps 10000
      - -v pbc2d 0
      - -v compute_interactions 0
      - -v store_forces 0
      - -v mpiio 0
      stderr_file: std.err
      stdout_file: std.out
      use_shell: true
      fizzle_bad_rc: true
    _trackers:
    - filename: log.lammps
      nlines: 25
    step: equilibration_npt

- fw_id: -60
  name: "LAMMPS Post-NPT-Equilibration"
  spec:
    _category: "juwels_noqueue"
    _files_in:
      log_file:  log.lammps
      data_file: datafile.lammps
    _files_out:
      thermo_file: thermo.out
    _tasks:
    _fw_name: CmdTask
      cmd: extract_thermo.sh # extracts thermo output from lammps log
      opt:
      - log.lammps # input file
      - thermo.out # output file
      stderr_file:   extract_thermo.err
      stdout_file:   extract_thermo.out
      fizzle_bad_rc: false
      use_shell:     true

    # first delete if file existent
    - _fw_name: DeleteFilesTask
      identifiers:
      - 646_SDS_on_AU_111_51x30x2_bilayer_with_counterion_50Ang_stepped_30Ang_dist_nptEquilibrated.lammps

    # then add again:
    - _fw_name: AddFilesTask
      identifiers:
      - 646_SDS_on_AU_111_51x30x2_bilayer_with_counterion_50Ang_stepped_30Ang_dist_nptEquilibrated.lammps
      paths:
      - datafile.lammps
      metadata:
      - system_name:      646_SDS_on_AU_111_51x30x2_bilayer_with_counterion_50Ang_stepped_30Ang_dist
        surfactant:       SDS
        sf_nmolecules:    646
        sf_preassembly:   bilayer
        counterion:       NA
        ci_preassembly:   at polar heads
        substrate:        AU
        sb_name:          AU_111_51x30x2
        sb_crystal_plane: 111
        sb_multiples:
        - 51
        - 30
        - 2
        solvent:          H2O
        sv_density:       997 # kg m^-3
        sv_preassembly:   random
        indenter:         AU
        indenter_pdb:     50Ang_stepped
        indenter_dist:    3.0 # nm, initial distance above substrate
        temperature:      298 # K
        pressure:         1 # atm
        state:            npt equilibrated

links:
  -10:
  - -20
  -20:
  - -30
  -25:
  - -30
  -30:
  - -40
  - -50
  -45:
  - -50
  -50:
  - -60

metadata:
  system_name:      646_SDS_on_AU_111_51x30x2_bilayer_with_counterion_50Ang_stepped_30Ang_dist
  surfactant:       SDS
  sf_nmolecules:    646
  sf_preassembly:   bilayer
  counterion:       NA
  ci_preassembly:   at polar heads
  substrate:        AU
  sb_name:          AU_111_51x30x2
  sb_crystal_plane: 111
  sb_multiples:
  - 51
  - 30
  - 2
  solvent:          H2O
  sv_density:       997 # kg m^-3
  sv_preassembly:   random
  indenter:         AU
  indenter_pdb:     50Ang_stepped
  indenter_dist:    7.5 # nm, initial distance above substrate
  temperature:      298 # K
  pressure:         1 # atm
