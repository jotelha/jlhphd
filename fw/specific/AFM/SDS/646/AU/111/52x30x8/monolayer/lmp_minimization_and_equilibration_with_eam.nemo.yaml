name: "NEMO: AFM SDS 646 AU 111 52x30x8 monolayer, minimization & equilibration "
fws:
- fw_id: -10
  name: "NEMO File Retrieval"
  spec:
    _category: "nemo_noqueue"
    _files_out:
      initial_config:  stripped.lammps
      input_header:    lmp_header.input
      input_minim:     lmp_minimization.input
      input_nvt:       lmp_equilibration_nvt.input
      input_npt:       lmp_equilibration_npt.input
      coeff_file:      coeff_hybrid.input
    _tasks:

    - _fw_name: GetFilesTask
      identifiers:
      - lmp_header.input
      - lmp_minimization.input
      - lmp_split_datafile.input
      - lmp_equilibration_nvt.input
      - lmp_equilibration_npt.input

    - _fw_name: GetFilesTask
      identifiers:
      - AFM/SDS/646/AU/111/52x30x8/monolayer/interface.lammps
      new_file_names:
      - datafile.lammps

    - _fw_name: CmdTask
      fizzle_bad_rc: true
      cmd: lmp
      opt:
      - -in lmp_split_datafile.input
      - -v surfactant_name SDS
      - -v has_indenter 0
      - -v pbc2d 0
      - -v freeze_substrate 0
      - -v use_eam 0
      - -v dataFile datafile.lammps
      - -v write_coeff 1
      - -v coeffOutfile coeff.input
      - -v topoOutfile  stripped.lammps
      stderr_file: strip.err
      stdout_file: strip.out
      use_shell: true

    - _fw_name: CmdTask
      fizzle_bad_rc: true
      cmd: to_hybrid.py
      opt:
      - coeff.input
      - coeff_hybrid.input
      stderr_file: convert.err
      stdout_file: convert.out
      use_shell: true

- fw_id: -20
  name: NEMO LAMMPS Minimization, fixed box, fixed substrate
  spec:
    _category: nemo_queue_offline
    _queueadapter:
      nodes: 4
      ppn: 20
      queue: ''
      walltime: 12:00:00
    _files_in:
      initial_config: datafile.lammps
      input_header:   lmp_header.input
      input_minim:    lmp_minimization.input
      coeff_file:     coeff.input
    _files_out:
      data_file: default.lammps
      log_file:  log.lammps
    _tasks:
    - _fw_name: CmdTask
      cmd: lmp
      opt:
      - -in lmp_minimization.input
      - -v surfactant_name          SDS
      - -v has_indenter             0
      - -v mpiio                    0
      - -v robust_minimization      0
      - -v pbc2d                    0
      - -v compute_interactions     0
      - -v store_forces             0
      - -v freeze_substrate         1
      - -v use_ewald                1
      - -v use_eam                  1
      - -v shrink_wrap_once         0
      - -v minimization_maxiter     10000
      - -v minimization_maxeval     100000
      - -v relax_box                0
      - -v write_coeff_to_datafile  0
      - -v dataFile                 datafile.lammps
      - -v coeffInfile              coeff.input
      stderr_file: std.err
      stdout_file: std.out
      fizzle_bad_rc: true
      use_shell: true
    _trackers:
    - filename: log.lammps
      nlines: 25
    step: minimization, fixed box, fixed substrate

- fw_id: -24
  name: NEMO LAMMPS Minimization, fixed box
  spec:
    _category: nemo_queue_offline
    _queueadapter:
      nodes: 4
      ppn: 20
      queue: ''
      walltime: 12:00:00
    _files_in:
      initial_config: datafile.lammps
      input_header:   lmp_header.input
      input_minim:    lmp_minimization.input
      coeff_file:     coeff.input
    _files_out:
      data_file: default.lammps
      log_file:  log.lammps
    _tasks:
    - _fw_name: CmdTask
      cmd: lmp
      opt:
      - -in lmp_minimization.input
      - -v surfactant_name          SDS
      - -v has_indenter             0
      - -v mpiio                    0
      - -v robust_minimization      0
      - -v pbc2d                    0
      - -v compute_interactions     0
      - -v store_forces             0
      - -v freeze_substrate         0
      - -v use_ewald                1
      - -v use_eam                  1
      - -v shrink_wrap_once         0
      - -v minimization_maxiter     10000
      - -v minimization_maxeval     100000
      - -v relax_box                0
      - -v write_coeff_to_datafile  0
      - -v dataFile                 datafile.lammps
      - -v coeffInfile              coeff.input
      stderr_file: std.err
      stdout_file: std.out
      fizzle_bad_rc: true
      use_shell: true
    _trackers:
    - filename: log.lammps
      nlines: 25
    step: minimization, fixed box

- fw_id: -28
  name: NEMO LAMMPS Minimization, relaxed box
  spec:
    _category: nemo_queue_offline
    _queueadapter:
      nodes: 4
      ppn: 20
      queue: ''
      walltime: 12:00:00
    _files_in:
      initial_config: datafile.lammps
      input_header:   lmp_header.input
      input_minim:    lmp_minimization.input
      coeff_file:     coeff.input
    _files_out:
      data_file: default.lammps
      log_file:  log.lammps
    _tasks:
    - _fw_name: CmdTask
      cmd: lmp
      opt:
      - -in lmp_minimization.input
      - -v surfactant_name          SDS
      - -v has_indenter             0
      - -v mpiio                    0
      - -v robust_minimization      0
      - -v pbc2d                    0
      - -v compute_interactions     0
      - -v store_forces             0
      - -v freeze_substrate         0
      - -v use_ewald                1
      - -v use_eam                  1
      - -v shrink_wrap_once         0
      - -v minimization_maxiter     10000
      - -v minimization_maxeval     100000
      - -v relax_box                1
      - -v write_coeff_to_datafile  0
      - -v dataFile                 datafile.lammps
      - -v coeffInfile              coeff.input
      stderr_file: std.err
      stdout_file: std.out
      fizzle_bad_rc: true
      use_shell: true
    _trackers:
    - filename: log.lammps
      nlines: 25
    step: minimization, fixed box

- fw_id: -30
  name: NEMO LAMMPS Equilibration NVT
  spec:
    _category: nemo_queue_offline
    _queueadapter:
      nodes: 4
      ppn: 20
      queue: ''
      walltime: 24:00:00
    _files_in:
      data_file:    datafile.lammps
      input_header: lmp_header.input
      input_nvt:    lmp_equilibration_nvt.input
      coeff_file:   coeff.input
    _files_out:
      data_file: default.lammps
      traj_file: default.nc
      log_file:  log.lammps
    _tasks:
    - _fw_name: CmdTask
      cmd: lmp
      opt:
      - -in lmp_equilibration_nvt.input
      - -v surfactant_name SDS
      - -v has_indenter 0
      - -v pbd2d 0
      - -v reinitialize_velocities 1
      - -v nvtEqSteps 10000
      - -v compute_interactions 0
      - -v store_forces 0
      - -v mpiio 1
      - -v use_eam 1
      - -v write_coeff_to_datafile 0
      - -v dataFile datafile.lammps
      - -v coeffInfile coeff.input
      stderr_file: std.err
      stdout_file: std.out
      use_shell: true
      fizzle_bad_rc: true
    _trackers:
    - filename: log.lammps
      nlines: 25
    step: equilibration_nvt

- fw_id: -40
  name: LAMMPS NPT equilibration
  spec:
    _category: nemo_queue_offline
    _queueadapter:
      nodes: 4
      ppn: 20
      queue: ''
      walltime: 24:00:00
    _files_in:
      data_file:    datafile.lammps
      input_header: lmp_header.input
      input_npt:    lmp_equilibration_npt.input
      coeff_file:   coeff.input
    _files_out:
      data_file: default.lammps
      traj_file: default.nc
      log_file:  log.lammps
    _tasks:
    - _fw_name: CmdTask
      cmd: lmp
      opt:
      - -in lmp_equilibration_npt.input
      - -v surfactant_name SDS
      - -v has_indenter 0
      - -v pbd2d 0
      - -v reinitialize_velocities 0
      - -v nptEqSteps 10000
      - -v pbc2d 0
      - -v compute_interactions 0
      - -v store_forces 0
      - -v mpiio 1
      - -v use_eam 1
      - -v write_coeff_to_datafile 0
      - -v dataFile     datafile.lammps
      - -v coeffInfile  coeff.input
      stderr_file: std.err
      stdout_file: std.out
      use_shell: true
      fizzle_bad_rc: true
    _trackers:
    - filename: log.lammps
      nlines: 25
    step: equilibration_npt

links:
  -10:
  - -20
  - -24
  - -28
  - -30
  - -40
  -20:
  - -24
  -24:
  - -28
  -28:
  - -30
  -30:
  - -40

metadata:
  system_name: 646_SDS_on_AU_111_51x30x8_monolayer_with_counterion
  state: trial minimization with eam potential
  ci_preassembly:                               at polar heads
  counterion:                                   NA
  pbc:                                          111 # periodic in all directions
  pressure:                                     1 # atm
  pressure_unit:                                atm
  sb_name:                                      AU_111_51x30x8
  sb_area:                                      2.20374e-16
  sb_area_unit:                                 m^2
  sb_area_per_sf_molecule:                      3.41007e-19
  sb_area_per_sf_molecule_unit:                 m^2
  sb_circular_area_per_sf_molecule_radius:      2e-10
  sb_circular_area_per_sf_molecule_radius_unit: m
  sb_crystal_plane:                             111
  sb_measures:
  - 1.47e-8
  - 1.50e-8
  - 5.60e-9
  sb_measures_unit:                             m
  sb_multiples:
  - 51
  - 30
  - 8
  sb_normal:        2 # z
  sb_square_area_per_sf_molecule_side:          6e-10
  sb_square_area_per_sf_molecule_side_unit:     m
  sb_thickness:                                 5.6e-9
  sb_thickness_unit:                            m
  sb_unit_cell:
  - 3e-10
  - 5e-10
  - 7e-10
  sb_unit_cell_unit:                            m
  sb_volume:                                    3.11331e-25
  sb_volume_unit:                               m^3
  sf_concentration:                             0.00680627
  sf_concentration_unit:                        M # M = mol L^-3
  sf_nmolecules:                                646
  sf_preassembly:                               monolayer
  solvent:                                      H2O
  substrate:                                    AU
  surfactant:                                   SDS
  sv_density:                                   997 # kg m^-3
  sv_density_unit:                              kg m^-3
  sv_preassembly:                               random
  temperature:                                  298 # K
  temperature_unit:                             K
