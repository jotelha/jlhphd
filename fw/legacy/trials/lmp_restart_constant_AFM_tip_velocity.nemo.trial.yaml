  name: "NEMO recover failed LAMMPS run"
  spec:
    _category: "nemo_noqueue"
    _allow_fizzled_parents: True
    _files_out:
      restart_file: default.mpiio.restart
    _tasks:
    - _fw_name: RecoverLammpsTask
      recover:      True # filter most recent restart file and forward
      repeated_recover_fw_name: NEMO recover failed LAMMPS run, repeatedly
      max_restarts: 5 # repeatedly append recover and restart fireworks
      # a firework to be appended as restart if initial LAMMPS run fails
      restart_fw:
        name: "NEMO LAMMPS restart run"
        spec:
          _category: "nemo_queue"
          _queueadapter:
            nodes: 1
            ppn: 20
            queue: 'express'
            walltime: 00:02:00
          _files_in:
            restart_file:    default.mpiio.restart
          _files_out:
            data_file:       default.lammps
            traj_file:       default.nc
            log_file:        lammps.log
            ave_file:        thermo_ave.out
          _tasks:
          - _fw_name: GetFilesTask
            identifiers:
            - lmp_header.input
            - lmp_production.input
            - lmp_production_mixed.input
          - _fw_name: CmdTask
            cmd: lmp
            opt:
            - -in lmp_production.input
            - -v surfactant_name SDS
            - -v has_indenter 1
            - -v constant_indenter_velocity -0.0001
            - -v productionSteps 375000
            - -v pbc2d 0
            - -v reinitialize_velocities 0
            - -v use_colvars 0
            - -v mpiio 1
            - -v thermo_frequency 1
            - -v thermo_average_frequency 10
            - -v netcdf_frequency 5
            - -v restart_frequency 10
            - -v compute_interactions 1
            - -v store_forces 1
            - -v is_restart 1
            - -v restartFile default.mpiio.restart
            stderr_file:   std.err
            stdout_file:   std.out
            fizzle_bad_rc: true
            use_shell:     true
          _trackers:
          - filename: log.lammps
            nlines: 25
