name: "LAMMPS Trial Run on JUWELS"
fws:
- fw_id: -1
  name: "JUWELS File Retrieval, Trial"
  spec:
    _category: "juwels_noqueue"
    _files_in:
      data_file: datafile.lammps
    _files_out:
      data_file:       datafile.lammps  
      input_file_1:    lmp_header.input
      input_file_2:    lmp_production.input
      input_file_3:    lmp_production_mixed.input
    _tasks:
    - _fw_name: GetFilesTask
      identifiers:
      - lmp_header.input
      - lmp_production.input
      - lmp_production_mixed.input
      - 646_SDS_on_AU_111_51x30x2_hemicylinders_with_counterion_50Ang_stepped_nptEquilibrated.lammps
      new_file_names:
      - lmp_header.input
      - lmp_production.input
      - lmp_production_mixed.input
      - datafile.lammps

- fw_id: -2
  name: "JUWELS LAMMPS Run, Trial"
  spec:
    _category: "juwels_queue"
    _queueadapter:
      nodes:           1
      ntasks:          48
      ntasks_per_node: 48
      cpus_per_task:   2
      queue:           devel
      walltime:        00:15:00
      account:         hka18
    _files_in:
      input_file_1:    lmp_header.input
      input_file_2:    lmp_production.input
      input_file_3:    lmp_production_mixed.input
      data_file:       datafile.lammps
    _files_out:
      data_file:       default.lammps
      traj_file:       default.nc
      log_file:        log.lammps
    _tasks:
    - _fw_name: ScriptTask
      script:
      - module purge; 
        jutil env activate -p chfr13;
        export KMP_BLOCKTIME=0;
        module use ${PROJECT}/hoermann/modules/modulefiles;
        module load Intel/2019.0.117-GCC-7.3.0 IntelMPI/2018.4.274;
        module load jlh/lammps/16Mar18-intel-2019-gcc-7.3-impi-2018-colvars-18Feb19;
        srun lmp -in lmp_production.input
        -v has_indenter 1 -v pbc2d 0 -v constant_indenter_velocity -0.0001 
        -v reinitialize_velocities 0 -v productionSteps 1000 -v use_colvars 0
        -v mpiio 1 -v thermo_frequency 100 -v thermo_average_frequency 100 
        -v netcdf_frequency 100 -v compute_interactions 1 -v store_forces 1
        -v surfactant_name SDS -sf intel -pk intel 0 omp 2
      stderr_file:   lmp_production.err
      stdout_file:   lmp_production.out
      fizzle_bad_rc: true
      use_shell:     true

- fw_id: -3
  name: "JUWELS LAMMPS Output File Evaluation"
  spec:
    _category: "juwels_noqueue"
    _files_in:
      log_file: log.lammps
    _files_out:
      thermo_file: thermo.out
    _tasks:
    - _fw_name: GetFilesTask
      identifiers:
      - extract_thermo.sh
    - _fw_name: ScriptTask
      script:
      - bash extract_thermo.sh log.lammps thermo.out
      use_shell:     true
      fizzle_bad_rc: false
      
links:
  -1:
  - -2
  -2:
  - -3

metadata:
  - system_name:      646_SDS_on_AU_111_51x30x2_hemicylinders_with_counterion_50Ang_stepped
    surfactant:       SDS
    sf_nmolecules:    646
    sf_preassembly:   hemicylinders
    counterion:       NA
    ci_preassembly:   at polar heads
    substrate:        AU
    sb_name:          AU_111_51x30x2
    sb_crystal_plane: 111
    sb_multiples:
    - 51
    - 30
    - 2
    solvent:          H2O
    sv_density:       997 # kg m^-3
    sv_preassembly:   random
    indenter:         AU
    indenter_pdb:     50Ang_stepped
    indenter_vel:     0.1 # m / s, constant speed, linear translation
    indenter_dist:    7.5 # nm, initial distance above substrate
    temperature:      298 # K
    pressure:         1 # atm
    total_steps:      37500000 # a 2 fs each
    total_time:       75 # ns
