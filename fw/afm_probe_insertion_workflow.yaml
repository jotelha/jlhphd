name: "AFM probe insertion on bwCloud"
fws:
- fw_id: -1
  name: Initiate AFM probe workflow
  spec:
    _category: bwcloud_std
    _files_out:
      indenter_file:  indenter.pdb
      interface_file: interface.lammps
    _tasks:
    - _fw_name: GetFilesTask
      identifiers:
      - 50Ang_stepped.pdb
      - 646_SDS_on_AU_111_51x30x2_hemicylinders_with_counterion_10ns.lammps
      new_file_names:
      - indenter.pdb
      - interface.lammps
    step: initiate_afm_probe_workflow

- fw_id: -2
  name: AFM probe insertion
  spec:
    _category: bwcloud_noqueue
    _files_in:
      indenter_file: indenter.pdb
      interface_file: interface.lammps
    _files_out:
      data_file: system.lammps
      pdb_file:  system.pdb
      psf_file:  system.psf
    _tasks:
    - _fw_name: GetFilesTask
      identifiers:
      - jlh_vmd.tcl
      - indenter_insertion.tcl
      new_file_names:
      - jlh_vmd.tcl
      - indenter_insertion.template
    - _fw_name: TemplateWriterTask
      context:
        desired_distance: 75.0 # in Angstrom
        indenter_file: indenter.pdb
        interface_file: interface.lammps
        output_prefix: system
        surfactant: SDS
      output_file: indenter_insertion.tcl
      template_file: indenter_insertion.template
    - _fw_name: CmdTask
      fizzle_bad_rc: true
      cmd: vmd
      opt: -eofexit -e indenter_insertion.tcl
      stderr_file: std.err
      stdout_file: std.out
      use_shell: true
    - _fw_name: CmdTask
      fizzle_bad_rc: false
      cmd: convert
      opt: system.tga system.png
      use_shell: true
    step: afm_probe_insertion

- fw_id: -3
  name: Merge AFM system coordinates and parameters
  spec:
    _category: bwcloud_std
    _files_in:
      data_file: datafile.lammps
    _files_out:
      data_file: initial.lammps
    _tasks:
    - _fw_name: GetFilesTask
      identifiers:
      - 646_SDS_on_AU_111_51x30x2_monolayer_with_counterion_psfgen.data
      new_file_names:
      - reffile.lammps
    - _fw_name: GetFilesTask
      identifiers:
      - MergeLammpsDataFiles.py
      - merge.py
      new_file_names:
      - MergeLammpsDataFiles.py
      - merge.py
    - _fw_name: CmdTask
      fizzle_bad_rc: true
      cmd: pizza.py
      opt:
      - -f merge.py
      - datafile.lammps
      - reffile.lammps
      - initial.lammps
      stderr_file: std.err
      stdout_file: std.out
      use_shell: true
    - _fw_name: DeleteFilesTask
      identifiers:
      - 646_SDS_on_AU_111_51x30x2_monolayer_with_counterion_50Ang_stepped_initial.lammps
    - _fw_name: AddFilesTask
      identifiers:
      - 646_SDS_on_AU_111_51x30x2_monolayer_with_counterion_50Ang_stepped_initial.lammps
      paths:
      - initial.lammps
      metadata:
        - system_name:      646_SDS_on_AU_111_51x30x2_monolayer_with_counterion_50Ang_stepped
          surfactant:       SDS
          sf_nmolecules:    646
          sf_preassembly:   monolayer
          counterion:       NA
          ci_preassembly:   at polar heads
          substrate:        AU
          sb_name:          AU_111_51x30x2
          sb_crystal_plane: 111
          sb_multiples:
          - 51
          - 30
          - 2
          solvent:          H2O
          sv_density:       997 # kg m^-3
          sv_preassembly:   random
          indenter:         AU
          indenter_pdb:     50Ang_stepped
          indenter_dist:    7.5 # nm, initial distance above substrate
          temperature:      298 # K
          pressure:         1 # atm
          step:             probe inserted
    step: pizzapy_merge

links:
  -1:
  - -2
  -2:
  - -3

metadata:
  - system_name:      646_SDS_on_AU_111_51x30x2_monolayer_with_counterion_50Ang_stepped
    surfactant:       SDS
    sf_nmolecules:    646
    sf_preassembly:   monolayer
    counterion:       NA
    ci_preassembly:   at polar heads
    substrate:        AU
    sb_name:          AU_111_51x30x2
    sb_crystal_plane: 111
    sb_multiples:
    - 51
    - 30
    - 2
    solvent:          H2O
    sv_density:       997 # kg m^-3
    sv_preassembly:   random
    indenter:         AU
    indenter_pdb:     50Ang_stepped
    indenter_dist:    7.5 # nm, initial distance above substrate
    temperature:      298 # K
    pressure:         1 # atm
